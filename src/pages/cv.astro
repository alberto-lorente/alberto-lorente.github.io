---
import Layout from '@/layouts/Layout.astro'
import { experiences, education, skills, publications } from '../data/cv'
import CvTimeline from '@/components/ui/CvTimeline.astro'

import type { Experience, Education, Publication } from '../types/cv'
import List from '@/components/ui/List.astro'
import PublicationsList from '@/components/ui/PublicationsList.astro'
import SkillList from '@/components/ui/SkillList.astro'

let orderedExperiences: Experience[] = []
let orderedEducations: Education[] = []
let orderedPublications: Publication[] = []

const orderElement = <T extends { time: string }>(a: T, b: T) => {
	const presentValues = ['present', 'now', 'current', 'today']
	if (
			presentValues.includes(
				(a['time'] as string)?.split(' - ')[1]?.toLowerCase()
			)
		) {
			// If the date is 'present', it should be the first element
			return -1
		}
		const dateA = new Date((a['time'] as string)?.split(' - ')[1])
		const dateB = new Date((b['time'] as string)?.split(' - ')[1])
		return dateB.getTime() - dateA.getTime()
}

if (experiences.length > 0) {
	orderedExperiences = experiences.sort((a, b) => {
		return orderElement(a, b)
	})
}

if (education.length > 0) {
	orderedEducations = education.sort((a, b) => {
		return orderElement(a, b)
	})
}

if (publications.length > 0) {
	orderedPublications = publications.sort((a, b) => {
		return orderElement(a, b)
	})
}
---

<Layout>
	{
		orderedEducations.length > 0 && (
			<section class='mb-12'>
				<h2 class='text-2xl font-bold mb-6 border-b pb-2'>
					Education
				</h2>
				<CvTimeline elements={orderedEducations} colored={true} />
			</section>
		)
	}

	{
		orderedExperiences.length > 0 && (
			<section class='mb-12'>
				<h2 class='text-2xl font-bold mb-6 border-b pb-2'>
					Work Experience
				</h2>
				<CvTimeline elements={orderedExperiences} colored={true} />
			</section>
		)
	}

<section class="mb-12 prose max-w-none">
	<h2 class="text-2xl font-bold mb-6 border-b pb-2">
		Past Research Projects
	</h2>
	<List
		listItems={[
		{
			title: "Continual Hate",
			description:
			"In 2025 I joined CNRS@CREATE in Singapore as an intern to research Domain-Incremental Continual Learning for Hate Speech Detection.\nThe main objective of the project was studying domain transfer feasibility among hate speech directed at general targets and the effect of CL on hate-positive predictions.\nAfter the first exploration focused on Transformer models, I moved to experimenting with QLoRA finetuned Llamas and possible LoRA merging techniques, mainly ZipLoRA, with more granular hate-targets. Finally, I conducted a small survey on time-agnostic/aware strategies and potential interactions with Continual Learning. The results of the project are expected to be published in 2026."
		}
		]}
	/>
</section>


	{
		orderedPublications.length > 0 && (
			<section class='mb-12'>
				<h2 class='text-2xl font-bold mb-6 border-b pb-2'>
					Language Skills
				</h2>
				<PublicationsList elements={orderedPublications}/>
			</section>
		)
	}

{
		skills.length > 0 && (
			<section class="mb-12">
			<SkillList listTitle="Skills" listItems={skills.map(s => s.title)} />
			</section>
		)
		}
</Layout>
